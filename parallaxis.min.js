function updateParallax(){for(var a=document.querySelectorAll("canvas[parallax-distance]"),e=0;e<a.length;e++){var l=a[e].getBoundingClientRect();if(l.top<window.innerHeight&&l.bottom>0){var t=(parallaxCanvasContext[e].canvas.height-parallaxImageBuffer[e].height)/2,n=Math.min(10,a[e].getAttribute("parallax-distance"));n=Math.max(1,10-n),t-=l.top/n;try{parallaxCanvasContext[e].drawImage(parallaxImageBuffer[e],0,t)}catch(r){}}}parallaxIsDrawing=!1}function parallaxScrolled(){parallaxLastScrollY=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),parallaxIsDrawing||(parallaxIsDrawing=!0,onScroll(updateParallax))}function parallaxPrepareCanvases(){for(var a=document.querySelectorAll("canvas[parallax-distance]"),e=0;e<a.length;e++){var l=window.getComputedStyle(a[e]);a[e].width=l.width.replace(/px/g,""),a[e].height=l.height.replace(/px/g,""),e in parallaxImageBuffer||(parallaxImageBuffer[e]=document.createElement("canvas"),parallaxCanvasContext[e]=a[e].getContext("2d")),parallaxImageBuffer[e].width=a[e].width,parallaxImageBuffer[e].height=parallaxOriginalImage[e].height/(parallaxOriginalImage[e].width/a[e].width),parallaxImageBuffer[e].getContext("2d").drawImage(parallaxOriginalImage[e],0,0,parallaxImageBuffer[e].width,parallaxImageBuffer[e].height)}if(parallaxIsDrawing=!1,onScroll(updateParallax),numSuccessfullyLoaded>=numToLoad){numToLoad=0,numSuccessfullyLoaded=-1;for(var e=0;e<a.length;e++)a[e].parentElement.style.backgroundImage="none"}}var onScroll=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},parallaxLastScrollY=0,parallaxIsDrawing=!1,parallaxOriginalImage=[],parallaxImageBuffer=[],parallaxCanvasContext=[],numToLoad=0,numSuccessfullyLoaded=0;!function(){var a=document.querySelectorAll("[parallax-distance]");if(a.length>0){numToLoad=a.length;for(var e=0;e<a.length;e++){var l=document.createElement("canvas");l.style.display="block",l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.zIndex="-1",l.setAttribute("parallax-distance",a[e].getAttribute("parallax-distance")),a[e].appendChild(l),a[e].removeAttribute("parallax-distance");var t=window.getComputedStyle(l);l.width=t.width.replace(/px/g,""),l.height=t.height.replace(/px/g,"");var n=window.getComputedStyle(a[e]).backgroundImage.match(/\((.*?)\)/)[1].replace(/('|")/g,"");n=n.replace(/\%7BLOADING\%7D\./gi,".").replace(/\{LOADING\}\./gi,"."),parallaxOriginalImage[e]=new Image,parallaxOriginalImage[e].onload=function(){numSuccessfullyLoaded++,parallaxPrepareCanvases()},parallaxOriginalImage[e].src=n}document.addEventListener?window.addEventListener("scroll",parallaxScrolled,!1):document.attachEvent&&window.attachEvent("onscroll",parallaxScrolled),document.addEventListener?window.addEventListener("resize",parallaxPrepareCanvases,!1):document.attachEvent&&window.attachEvent("onresize",parallaxPrepareCanvases)}}();
